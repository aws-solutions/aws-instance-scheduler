; Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
; SPDX-License-Identifier: Apache-2.0

[tox]
env_list =
    lambda
    cdk
    lint
    eslint
minversion = 4.0.13
package_root = source/app

[gh-actions]
python =
    3.9: lambda, cdk, lint, eslint
    3.10: lambda
    3.11: lambda

[testenv:lint]
description = run lint checks
skip_install = true
deps =
    black
commands =
    black --check source

[testenv:eslint]
description = run eslint checks
allowlist_externals =
    npm
    npx
change_dir = source/infrastructure
package = skip
commands =
    npm install
    npx prettier --check '**/*.ts'
    npx eslint --ext .ts --max-warnings=0 .

[testenv:lambda]
description = run lambda unit tests
package = wheel
wheel_build_env = .pkg
deps =
    pytest
extras = dev
commands =
    pytest source/app/tests {posargs}

[testenv:cdk]
allowlist_externals = npm
change_dir = source/infrastructure
description = run CDK unit tests
package = skip
commands =
    npm install
    npm run test -- {posargs}
